# Deep SORT å¤šç›®æ ‡è¿½è¸ªé›†æˆæŒ‡å—

## æ¦‚è¿°

æœ¬é¡¹ç›®å·²æˆåŠŸé›†æˆåŸºäºDeep SORTçš„å¤šç›®æ ‡è¿½è¸ªåŠŸèƒ½ï¼Œä¸ºæ£€æµ‹åˆ°çš„ç›®æ ‡æä¾›æŒä¹…æ€§çš„track_idï¼Œæ˜¾è‘—æé«˜äº†ç›®æ ‡è¿½è¸ªçš„ç¨³å®šæ€§å’Œå‡†ç¡®æ€§ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

### âœ… å·²å®ç°åŠŸèƒ½

1. **ä¸“ä¸šçº§å¤šç›®æ ‡è¿½è¸ª**
   - ä½¿ç”¨Deep SORTç®—æ³•è¿›è¡Œç›®æ ‡è¿½è¸ª
   - æä¾›æŒä¹…æ€§çš„tracking_id
   - æ”¯æŒç›®æ ‡é‡è¯†åˆ«(Re-ID)
   - å¤„ç†ç›®æ ‡é®æŒ¡å’Œé‡æ–°å‡ºç°

2. **åŒé‡è¿½è¸ªç­–ç•¥**
   - **ç›®æ ‡æ£€æµ‹**: ä½¿ç”¨Deep SORTè¿›è¡Œä¸“ä¸šè¿½è¸ª
   - **äººè„¸è¯†åˆ«**: ä¿ç•™ç°æœ‰çš„é«˜åº¦ä¼˜åŒ–ç¨³å®šåŒ–ç®—æ³•
   - ä¸¤å¥—ç³»ç»Ÿç‹¬ç«‹è¿è¡Œï¼Œäº’ä¸å¹²æ‰°

3. **æ™ºèƒ½å¤‡ç”¨æœºåˆ¶**
   - Deep SORTä¸å¯ç”¨æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨è¿½è¸ªå™¨
   - åŸºäºIoUåŒ¹é…çš„ç®€å•è¿½è¸ªç®—æ³•
   - ç¡®ä¿ç³»ç»Ÿé²æ£’æ€§

4. **å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†**
   - è‡ªåŠ¨åˆå§‹åŒ–è¿½è¸ªå™¨å®ä¾‹
   - æ‘„åƒå¤´åœæ­¢æ—¶è‡ªåŠ¨æ¸…ç†èµ„æº
   - å†…å­˜æ³„æ¼é˜²æŠ¤

## æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AIè§†é¢‘åˆ†æç³»ç»Ÿ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¾“å…¥: è§†é¢‘å¸§ + YOLOv8æ£€æµ‹ç»“æœ                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   æ£€æµ‹ç»“æœåˆ†ç¦»    â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
              â”‚        â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”   â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ç›®æ ‡æ£€æµ‹   â”‚   â”‚ äººè„¸è¯†åˆ«            â”‚
    â”‚ (éäººè„¸)   â”‚   â”‚ (faceç±»å‹)         â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚            â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚Deep SORT  â”‚   â”‚ ç°æœ‰ç¨³å®šåŒ–ç®—æ³•        â”‚
    â”‚ä¸“ä¸šè¿½è¸ª    â”‚   â”‚ (é«˜åº¦ä¼˜åŒ–)           â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚            â”‚
          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   åˆå¹¶è¿½è¸ªç»“æœ         â”‚
    â”‚ tracking_id + ç¨³å®šæ€§   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä½¿ç”¨æ–¹æ³•

### 1. å®‰è£…ä¾èµ–

```bash
# å®‰è£…Deep SORTä¾èµ–
pip install deep_sort_pytorch>=1.0.1
pip install torchvision>=0.15.0
pip install scikit-learn>=1.0.0
```

### 2. APIä½¿ç”¨

#### å¸§åˆ†ææ¥å£ (æ¨è)

```python
import requests

# åˆ†æå•å¸§å›¾åƒ
with open('test_image.jpg', 'rb') as f:
    response = requests.post(
        'http://localhost:8001/frame/analyze/',
        files={'frame': f},
        data={
            'camera_id': 'cam_001',
            'enable_object_detection': True,
            'enable_face_recognition': True,
            'performance_mode': 'balanced'
        }
    )

result = response.json()
for detection in result['results']['detections']:
    if detection['type'] == 'object':
        print(f"ç›®æ ‡: {detection['class_name']}")
        print(f"è¿½è¸ªID: {detection['tracking_id']}")  # Deep SORTæä¾›
        print(f"åæ ‡: {detection['bbox']}")
```

#### æµåª’ä½“æ¥å£

```python
# å¯åŠ¨æµå¤„ç†
config = {
    "camera_id": "cam_001",
    "stream_url": "rtsp://camera_ip/stream",
    "enable_face_recognition": True,
    "enable_behavior_detection": True,
    "enable_sound_detection": True,
    "enable_fire_detection": True
}

response = requests.post(
    'http://localhost:8001/stream/start/',
    json=config
)
```

### 3. è¿½è¸ªç»“æœæ ¼å¼

#### ç›®æ ‡æ£€æµ‹ç»“æœ (Deep SORT)

```json
{
    "type": "object",
    "class_name": "person",
    "confidence": 0.85,
    "bbox": [100, 150, 200, 300],
    "tracking_id": "DS_123",  // Deep SORT ID (æŒä¹…æ€§)
    "timestamp": "2024-01-01T12:00:00"
}
```

#### äººè„¸è¯†åˆ«ç»“æœ (ç¨³å®šåŒ–)

```json
{
    "type": "face",
    "known": true,
    "name": "å¼ ä¸‰",
    "confidence": 0.92,
    "bbox": [50, 60, 150, 180],
    "tracking_id": "face_456",  // ç¨³å®šåŒ–ID
    "timestamp": "2024-01-01T12:00:00"
}
```

## é…ç½®é€‰é¡¹

### Deep SORTå‚æ•°è°ƒä¼˜

```python
# åœ¨ multi_object_tracker.py ä¸­å¯è°ƒèŠ‚çš„å‚æ•°
tracker = DeepSORTTracker(
    max_dist=0.2,           # æœ€å¤§ä½™å¼¦è·ç¦»é˜ˆå€¼
    min_confidence=0.3,     # æœ€å°æ£€æµ‹ç½®ä¿¡åº¦
    nms_max_overlap=1.0,    # NMSæœ€å¤§é‡å é˜ˆå€¼
    max_iou_distance=0.7,   # æœ€å¤§IoUè·ç¦»
    max_age=30,             # ç›®æ ‡æœ€å¤§ç”Ÿå­˜æ—¶é—´ï¼ˆå¸§æ•°ï¼‰
    n_init=3                # ç¡®è®¤è½¨é“æ‰€éœ€çš„è¿ç»­æ£€æµ‹æ¬¡æ•°
)
```

### å¤‡ç”¨è¿½è¸ªå™¨å‚æ•°

```python
# FallbackTracker å‚æ•°
fallback_tracker = FallbackTracker()
fallback_tracker.max_disappeared = 10   # æœ€å¤§æ¶ˆå¤±å¸§æ•°
fallback_tracker.iou_threshold = 0.3    # IoUåŒ¹é…é˜ˆå€¼
```

## æ€§èƒ½ä¼˜åŒ–

### 1. å†…å­˜ç®¡ç†

- è¿½è¸ªå™¨å®ä¾‹æŒ‰camera_idç®¡ç†
- æ‘„åƒå¤´åœæ­¢æ—¶è‡ªåŠ¨æ¸…ç†èµ„æº
- å†å²è½¨é“æ•°æ®å®šæœŸæ¸…ç†

### 2. å¤„ç†æ€§èƒ½

- æ”¯æŒ3ç§æ€§èƒ½æ¨¡å¼: fast/balanced/quality
- åŠ¨æ€å›¾åƒç¼©æ”¾é€‚åº”ç¡¬ä»¶æ€§èƒ½
- å¹¶è¡Œå¤„ç†ç›®æ ‡æ£€æµ‹å’Œäººè„¸è¯†åˆ«

### 3. å‘Šè­¦ç³»ç»Ÿ

```python
# å‘Šè­¦åŒ…å«è¿½è¸ªä¿¡æ¯
alert = {
    "type": "person_detected",
    "message": "æ£€æµ‹åˆ°äººå‘˜ (è¿½è¸ªID: DS_123)",
    "confidence": 0.85,
    "location": [100, 150, 200, 300],
    "tracking_id": "DS_123"  # ç”¨äºè¿½è¸ªå†å²
}
```

## æ•…éšœæ’é™¤

### 1. Deep SORTåº“å®‰è£…é—®é¢˜

```bash
# å¦‚æœå®‰è£…å¤±è´¥ï¼Œå°è¯•ä»æºç å®‰è£…
git clone https://github.com/ZQPei/deep_sort_pytorch.git
cd deep_sort_pytorch
pip install -e .
```

### 2. æ¨¡å‹æ–‡ä»¶ç¼ºå¤±

```
âš ï¸ Deep SORTåˆå§‹åŒ–å¤±è´¥: [Errno 2] No such file or directory: './weights/ckpt.t7'
```

**è§£å†³æ–¹æ¡ˆ**: ç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨å¤‡ç”¨è¿½è¸ªå™¨ï¼ŒåŠŸèƒ½ä¸å—å½±å“ã€‚

### 3. æ€§èƒ½é—®é¢˜

- ä½¿ç”¨ `performance_mode: "fast"` å‡å°‘è®¡ç®—è´Ÿæ‹…
- é™ä½å›¾åƒåˆ†è¾¨ç‡
- å‡å°‘åŒæ—¶å¤„ç†çš„æ‘„åƒå¤´æ•°é‡

## æµ‹è¯•éªŒè¯

```bash
# è¿è¡Œé›†æˆæµ‹è¯•
python test_deepsort_integration.py

# é¢„æœŸè¾“å‡º
ğŸš€ å¼€å§‹Deep SORTé›†æˆæµ‹è¯•
ğŸ” æµ‹è¯•Deep SORTè¿½è¸ªå™¨...
âœ… Deep SORTè¿½è¸ªå™¨åˆ›å»ºæˆåŠŸ
ğŸ¯ è¾“å…¥æ£€æµ‹ç»“æœ: 2ä¸ªç›®æ ‡
ğŸ¯ è¿½è¸ªç»“æœ: 2ä¸ªç›®æ ‡
âœ… Deep SORTè¿½è¸ªå™¨æµ‹è¯•é€šè¿‡

ğŸ“Š æµ‹è¯•æ€»ç»“: 3/3 æµ‹è¯•é€šè¿‡
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Deep SORTé›†æˆæˆåŠŸï¼
```

## æŠ€æœ¯è§„æ ¼

### è¿½è¸ªIDæ ¼å¼

- Deep SORT: `DS_{track_id}` (ä¾‹: DS_123)
- å¤‡ç”¨è¿½è¸ªå™¨: `FB_{track_id}` (ä¾‹: FB_456)
- äººè„¸ç¨³å®šåŒ–: `face_{id}` (ä¾‹: face_789)

### æ”¯æŒçš„ç›®æ ‡ç±»åˆ«

æ”¯æŒCOCOæ•°æ®é›†çš„æ‰€æœ‰80ä¸ªç±»åˆ«ï¼ŒåŒ…æ‹¬ï¼š
- person, bicycle, car, motorcycle, airplane
- bus, train, truck, boat, traffic light
- ç­‰ç­‰...

### ç³»ç»Ÿè¦æ±‚

- Python 3.8+
- CUDAæ”¯æŒ(æ¨è)
- å†…å­˜: å»ºè®®4GBä»¥ä¸Š
- å¤„ç†å™¨: æ”¯æŒå¤šçº¿ç¨‹

## æ›´æ–°æ—¥å¿—

### v2.0.0 (2024-01-01)
- âœ… é›†æˆDeep SORTå¤šç›®æ ‡è¿½è¸ª
- âœ… å®ç°å¤‡ç”¨è¿½è¸ªæœºåˆ¶
- âœ… ä¿ç•™äººè„¸è¯†åˆ«ç¨³å®šåŒ–
- âœ… æ·»åŠ è¿½è¸ªIDåˆ°å‘Šè­¦ç³»ç»Ÿ
- âœ… å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†

---

**æ³¨æ„**: æœ¬é›†æˆä¿æŒäº†ä¸ç°æœ‰ç³»ç»Ÿçš„å®Œå…¨å…¼å®¹æ€§ï¼Œäººè„¸è¯†åˆ«åŠŸèƒ½çš„é«˜åº¦ä¼˜åŒ–ç¨³å®šåŒ–ç®—æ³•ä¿æŒä¸å˜ï¼Œä»…å¯¹é€šç”¨ç›®æ ‡æ£€æµ‹ä½¿ç”¨Deep SORTè¿½è¸ªã€‚ 