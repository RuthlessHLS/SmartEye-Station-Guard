                                                                                                                                                                                                                                                                                    worker_processes auto;
events {
    worker_connections 1024;
}

# RTMP 配置
rtmp {
    server {
        listen 1935;
        chunk_size 4096;
        
        # 用于接收外部推流的应用
        application live {
            live on;
            record off;
            
            # 将流推送到AI服务
            push rtmp://localhost:1936/ai_process;
        }
        
        # AI处理后的流
        application processed {
            live on;
            record off;
        }
    }
}

# HTTP 配置
http {
    include mime.types;
    default_type application/octet-stream;
    sendfile on;
    keepalive_timeout 65;
    
    server {
        listen 8080;
        server_name localhost;
        
        # HLS 配置
        location /hls {
            types {
                application/vnd.apple.mpegurl m3u8;
                video/mp2t ts;
            }
            root /tmp;
            add_header Cache-Control no-cache;
            add_header Access-Control-Allow-Origin *;
        }
        
        # DASH 配置
        location /dash {
            root /tmp;
            add_header Cache-Control no-cache;
            add_header Access-Control-Allow-Origin *;
        }
    }
} 