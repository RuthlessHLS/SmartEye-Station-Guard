# ğŸš¨ å±é™©åŒºåŸŸæ£€æµ‹åŠŸèƒ½è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

å±é™©åŒºåŸŸæ£€æµ‹æ˜¯SmartEye-Station-Guardç³»ç»Ÿçš„é«˜çº§å®‰å…¨åŠŸèƒ½ï¼Œèƒ½å¤Ÿå®æ—¶ç›‘æ§æŒ‡å®šåŒºåŸŸå†…çš„äººå‘˜æ´»åŠ¨ï¼ŒåŠæ—¶å‘ç°å…¥ä¾µã€åœç•™è¶…æ—¶ç­‰å¼‚å¸¸è¡Œä¸ºï¼Œä¸ºå®‰å…¨ç›‘æ§æä¾›å¼ºæœ‰åŠ›çš„æŠ€æœ¯æ”¯æ’‘ã€‚

## æ ¸å¿ƒç‰¹æ€§

### ğŸ¯ å¤šè¾¹å½¢åŒºåŸŸå®šä¹‰
- æ”¯æŒä»»æ„å¤šè¾¹å½¢å±é™©åŒºåŸŸç»˜åˆ¶
- ç²¾ç¡®çš„å‡ ä½•ç®—æ³•è®¡ç®—ï¼ˆRay Castingç®—æ³•ï¼‰
- å®æ—¶Canvasäº¤äº’ç»˜åˆ¶ä½“éªŒ

### ğŸ“ æ™ºèƒ½è·ç¦»æ£€æµ‹
- ç‚¹åˆ°å¤šè¾¹å½¢è¾¹ç¼˜çš„ç²¾ç¡®è·ç¦»è®¡ç®—
- å¯é…ç½®è·ç¦»é˜ˆå€¼å‘Šè­¦
- åƒç´ çº§ç²¾åº¦å®šä½

### â±ï¸ åœç•™æ—¶é—´è¿½è¸ª
- æŒç»­è¿½è¸ªäººå‘˜åœ¨åŒºåŸŸå†…çš„åœç•™æ—¶é—´
- å¯é…ç½®åœç•™æ—¶é—´é˜ˆå€¼
- é˜²æ­¢é‡å¤å‘Šè­¦æœºåˆ¶

### ğŸ”„ å¤šç›®æ ‡è¿½è¸ªé›†æˆ
- åŸºäºDeep SORTçš„äººå‘˜è¿½è¸ªID
- æŒä¹…åŒ–äººå‘˜èº«ä»½è¯†åˆ«
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸè¿½è¸ªæ•°æ®

## åŠŸèƒ½æ¶æ„

### 1. å‰ç«¯Canvasç»˜åˆ¶ç³»ç»Ÿ

#### äº¤äº’å¼åŒºåŸŸç»˜åˆ¶
```typescript
// å¼€å§‹ç»˜åˆ¶æ¨¡å¼
const startDrawingZone = () => {
  isDrawingZone.value = true
  overlayCanvas.value.style.pointerEvents = 'auto'
  overlayCanvas.value.addEventListener('click', handleCanvasClick)
}

// å®æ—¶åæ ‡è½¬æ¢
const handleCanvasClick = (event) => {
  const rect = overlayCanvas.value.getBoundingClientRect()
  const canvasX = (event.clientX - rect.left / rect.width) * overlayCanvas.value.width
  const canvasY = (event.clientY - rect.top / rect.height) * overlayCanvas.value.height
  currentZonePoints.value.push([canvasX, canvasY])
}
```

#### åŒºåŸŸå¯è§†åŒ–æ¸²æŸ“
- å®æ—¶é¢„è§ˆç»˜åˆ¶ä¸­çš„åŒºåŸŸ
- åŠé€æ˜å¡«å……æ˜¾ç¤ºå·²å®ŒæˆåŒºåŸŸ
- é¡¶ç‚¹åºå·æ ‡è¯†
- åŒºåŸŸåç§°æ ‡ç­¾

### 2. AIæœåŠ¡å‡ ä½•ç®—æ³•

#### Ray Castingç‚¹åœ¨å¤šè¾¹å½¢å†…åˆ¤æ–­
```python
@staticmethod
def point_in_polygon(point: Point, polygon: List[Point]) -> bool:
    """ä½¿ç”¨å°„çº¿æŠ•å°„ç®—æ³•åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨å¤šè¾¹å½¢å†…"""
    x, y = point.x, point.y
    n = len(polygon)
    inside = False
    
    p1x, p1y = polygon[0].x, polygon[0].y
    for i in range(1, n + 1):
        p2x, p2y = polygon[i % n].x, polygon[i % n].y
        if y > min(p1y, p2y):
            if y <= max(p1y, p2y):
                if x <= max(p1x, p2x):
                    if p1y != p2y:
                        xinters = (y - p1y) * (p2x - p1x) / (p2y - p1y) + p1x
                    if p1x == p2x or x <= xinters:
                        inside = not inside
        p1x, p1y = p2x, p2y
    
    return inside
```

#### ç‚¹åˆ°å¤šè¾¹å½¢è·ç¦»è®¡ç®—
```python
@staticmethod
def point_to_polygon_distance(point: Point, polygon: List[Point]) -> float:
    """è®¡ç®—ç‚¹åˆ°å¤šè¾¹å½¢è¾¹ç¼˜çš„æœ€çŸ­è·ç¦»"""
    if GeometryUtils.point_in_polygon(point, polygon):
        return 0.0
    
    min_distance = float('inf')
    for i in range(len(polygon)):
        j = (i + 1) % len(polygon)
        distance = GeometryUtils.point_to_line_distance(point, polygon[i], polygon[j])
        min_distance = min(min_distance, distance)
    
    return min_distance
```

### 3. äººå‘˜è¿½è¸ªä¸çŠ¶æ€ç®¡ç†

#### PersonTrackerç±»
```python
@dataclass
class PersonTracker:
    tracking_id: str
    first_detected_time: float = field(default_factory=time.time)
    last_seen_time: float = field(default_factory=time.time)
    zone_entry_time: Optional[float] = None
    current_position: Optional[Point] = None
    inside_zone: bool = False
    distance_to_zone: float = float('inf')
    alert_triggered: bool = False
```

#### æ™ºèƒ½å‘Šè­¦ç­–ç•¥
- **å…¥ä¾µå‘Šè­¦**: äººå‘˜è¿›å…¥å±é™©åŒºåŸŸæ—¶ç«‹å³è§¦å‘
- **åœç•™å‘Šè­¦**: åœ¨åŒºåŸŸå†…åœç•™è¶…è¿‡è®¾å®šæ—¶é—´åè§¦å‘
- **æ¥è¿‘å‘Šè­¦**: äººå‘˜è·ç¦»åŒºåŸŸè¾¹ç¼˜å°äºé˜ˆå€¼æ—¶è§¦å‘
- **å†·å´æœºåˆ¶**: é˜²æ­¢åŒä¸€äº‹ä»¶é‡å¤å‘Šè­¦

## ä½¿ç”¨æŒ‡å—

### æ­¥éª¤1: å¯åŠ¨ç³»ç»Ÿ
```bash
# å¯åŠ¨AIæœåŠ¡
cd smart_station_platform/ai_service
python app.py

# å¯åŠ¨å‰ç«¯
cd smart_station_platform/frontend
npm run dev

# å¯åŠ¨åç«¯ï¼ˆå¦‚éœ€å­˜å‚¨å‘Šè­¦ï¼‰
cd smart_station_platform/backend
python manage.py runserver
```

### æ­¥éª¤2: å¼€å§‹ç›‘æ§
1. æ‰“å¼€AIè§†é¢‘ç›‘æ§é¡µé¢
2. é€‰æ‹©æ‘„åƒå¤´å¹¶å¯åŠ¨è§†é¢‘æµ
3. ç¡®ä¿ç›®æ ‡æ£€æµ‹å’Œäººè„¸è¯†åˆ«å·²å¯ç”¨

### æ­¥éª¤3: ç»˜åˆ¶å±é™©åŒºåŸŸ
1. ç‚¹å‡»"ç»˜åˆ¶åŒºåŸŸ"æŒ‰é’®
2. åœ¨è§†é¢‘ç”»é¢ä¸Šç‚¹å‡»ç»˜åˆ¶å¤šè¾¹å½¢é¡¶ç‚¹
3. å³é”®å®ŒæˆåŒºåŸŸç»˜åˆ¶
4. è®¾ç½®åŒºåŸŸå‚æ•°ï¼š
   - **åŒºåŸŸåç§°**: ä¾¿äºè¯†åˆ«çš„åç§°
   - **è·ç¦»é˜ˆå€¼**: è§¦å‘æ¥è¿‘å‘Šè­¦çš„è·ç¦»(åƒç´ )
   - **åœç•™é˜ˆå€¼**: è§¦å‘åœç•™å‘Šè­¦çš„æ—¶é—´(ç§’)

### æ­¥éª¤4: ç®¡ç†åŒºåŸŸ
- **æŸ¥çœ‹åŒºåŸŸ**: ç‚¹å‡»"åŒºåŸŸç®¡ç†"æŸ¥çœ‹æ‰€æœ‰é…ç½®
- **åˆ é™¤åŒºåŸŸ**: åœ¨ç®¡ç†ç•Œé¢åˆ é™¤ä¸éœ€è¦çš„åŒºåŸŸ
- **åŒæ­¥é…ç½®**: ç‚¹å‡»"åŒæ­¥åˆ°AIæœåŠ¡"ä¿å­˜é…ç½®

### æ­¥éª¤5: ç›‘æ§å‘Šè­¦
- å®æ—¶å‘Šè­¦é¢æ¿æ˜¾ç¤ºå±é™©åŒºåŸŸäº‹ä»¶
- æ£€æµ‹ç»“æœä¸­åŒ…å«åŒºåŸŸå…¥ä¾µä¿¡æ¯
- åç«¯å­˜å‚¨è¯¦ç»†å‘Šè­¦è®°å½•

## APIæ¥å£

### é…ç½®å±é™©åŒºåŸŸ
```http
POST /danger_zone/config/
Content-Type: application/json

{
  "camera_id": "webcam_monitor",
  "zones": [
    {
      "name": "è®¾å¤‡æ“ä½œåŒº",
      "coordinates": [[100, 100], [300, 100], [300, 300], [100, 300]],
      "min_distance_threshold": 50.0,
      "time_in_area_threshold": 10,
      "is_active": true
    }
  ]
}
```

### è·å–åŒºåŸŸçŠ¶æ€
```http
GET /danger_zone/status/{camera_id}
```

### åˆ é™¤åŒºåŸŸ
```http
DELETE /danger_zone/{camera_id}/{zone_id}
```

## å‘Šè­¦ç±»å‹

### 1. åŒºåŸŸå…¥ä¾µ (danger_zone_entry)
```json
{
  "type": "danger_zone_entry",
  "message": "äººå‘˜ FB_1 è¿›å…¥å±é™©åŒºåŸŸ è®¾å¤‡æ“ä½œåŒº",
  "tracking_id": "FB_1",
  "zone_name": "è®¾å¤‡æ“ä½œåŒº",
  "position": [250, 200]
}
```

### 2. åœç•™è¶…æ—¶ (danger_zone_dwell)
```json
{
  "type": "danger_zone_dwell", 
  "message": "äººå‘˜ FB_1 åœ¨å±é™©åŒºåŸŸ è®¾å¤‡æ“ä½œåŒº åœç•™è¶…è¿‡ 10 ç§’",
  "tracking_id": "FB_1",
  "dwell_time": 15.3,
  "zone_name": "è®¾å¤‡æ“ä½œåŒº"
}
```

### 3. æ¥è¿‘å‘Šè­¦ (danger_zone_proximity)
```json
{
  "type": "danger_zone_proximity",
  "message": "äººå‘˜ FB_2 æ¥è¿‘å±é™©åŒºåŸŸ è®¾å¤‡æ“ä½œåŒº (è·ç¦»: 35.2åƒç´ )",
  "tracking_id": "FB_2", 
  "distance": 35.2,
  "zone_name": "è®¾å¤‡æ“ä½œåŒº"
}
```

## æ€§èƒ½ä¼˜åŒ–

### 1. å‡ ä½•ç®—æ³•ä¼˜åŒ–
- ä½¿ç”¨ç¨€ç–é‡‡æ ·è¿›è¡Œå¿«é€Ÿé¢„åˆ¤
- è¾¹ç•Œæ¡†é¢„ç­›é€‰å‡å°‘è®¡ç®—é‡
- ç¼“å­˜å¤šè¾¹å½¢è¾¹ç•Œæ¡†ä¿¡æ¯

### 2. è¿½è¸ªå™¨ç®¡ç†
- è‡ªåŠ¨æ¸…ç†30ç§’æœªè§çš„è¿½è¸ªå™¨
- æœ€å°åŒ–å†…å­˜å ç”¨
- é«˜æ•ˆçš„å“ˆå¸Œè¡¨æŸ¥æ‰¾

### 3. å‘Šè­¦å»é‡
- 5ç§’å†·å´æ—¶é—´é˜²æ­¢é‡å¤å‘Šè­¦
- çŠ¶æ€å˜åŒ–é©±åŠ¨çš„äº‹ä»¶æ¨¡å‹
- å¼‚æ­¥åç«¯é€šä¿¡é¿å…é˜»å¡

## åº”ç”¨åœºæ™¯

### ğŸ­ å·¥ä¸šå®‰å…¨
- ç¦æ­¢è¿›å…¥çš„å±é™©è®¾å¤‡åŒºåŸŸ
- é«˜å‹ç”µåŒºåŸŸäººå‘˜ç›‘æ§
- åŒ–å­¦å“å­˜å‚¨åŒºåŸŸç®¡åˆ¶

### ğŸ¢ åŠå…¬å®‰å…¨  
- æœåŠ¡å™¨æœºæˆ¿è®¿é—®æ§åˆ¶
- é‡è¦æ–‡ä»¶å­˜å‚¨åŒºç›‘æ§
- å®‰å…¨å‡ºå…¥å£ç®¡ç†

### ğŸ  å®¶åº­å®‰å…¨
- å„¿ç«¥æ´»åŠ¨åŒºåŸŸç›‘æ§
- å¨æˆ¿å±é™©åŒºåŸŸæé†’
- æ¥¼æ¢¯å£å®‰å…¨ç›‘æŠ¤

### ğŸ¥ åŒ»ç–—ç¯å¢ƒ
- æ‰‹æœ¯å®¤æ— èŒåŒºåŸŸ
- å±é™©è¯å“å­˜å‚¨åŒº
- é‡ç—‡ç›‘æŠ¤åŒºåŸŸç®¡ç†

## æŠ€æœ¯è§„æ ¼

- **æ£€æµ‹ç²¾åº¦**: åƒç´ çº§ç²¾ç¡®å®šä½
- **å“åº”å»¶è¿Ÿ**: < 100mså®æ—¶æ£€æµ‹
- **åŒºåŸŸæ•°é‡**: æ¯æ‘„åƒå¤´æ”¯æŒ10+ä¸ªåŒºåŸŸ
- **å¹¶å‘è¿½è¸ª**: æ”¯æŒ20+äººå‘˜åŒæ—¶è¿½è¸ª
- **å‡ ä½•ç®—æ³•**: O(n)å¤æ‚åº¦å°„çº¿æŠ•å°„
- **å…¼å®¹æ€§**: æ”¯æŒä»»æ„å¤šè¾¹å½¢å½¢çŠ¶

## æ•…éšœæ’é™¤

### é—®é¢˜1: åŒºåŸŸç»˜åˆ¶ä¸å“åº”
- ç¡®ä¿æ‘„åƒå¤´å·²å¯åŠ¨
- æ£€æŸ¥Canvaså…ƒç´ æ˜¯å¦æ­£ç¡®åˆå§‹åŒ–
- éªŒè¯äº‹ä»¶ç›‘å¬å™¨ç»‘å®šçŠ¶æ€

### é—®é¢˜2: æ£€æµ‹ç»“æœä¸å‡†ç¡®
- æ£€æŸ¥åæ ‡ç³»è½¬æ¢æ˜¯å¦æ­£ç¡®
- éªŒè¯è§†é¢‘åˆ†è¾¨ç‡ä¸Canvaså°ºå¯¸åŒ¹é…
- ç¡®è®¤ç›®æ ‡æ£€æµ‹åŠŸèƒ½æ­£å¸¸å·¥ä½œ

### é—®é¢˜3: å‘Šè­¦é‡å¤è§¦å‘
- æ£€æŸ¥å†·å´æ—¶é—´è®¾ç½®
- éªŒè¯è¿½è¸ªIDç¨³å®šæ€§
- è°ƒæ•´è·ç¦»å’Œæ—¶é—´é˜ˆå€¼

### é—®é¢˜4: æ€§èƒ½å½±å“
- å‡å°‘å±é™©åŒºåŸŸæ•°é‡
- é™ä½æ£€æµ‹é¢‘ç‡
- å¯ç”¨æ€§èƒ½ä¼˜åŒ–æ¨¡å¼

---

**å¼€å‘å›¢é˜Ÿ**: SmartEye-Station-Guard
**ç‰ˆæœ¬**: v1.0.0
**æ›´æ–°æ—¥æœŸ**: 2024å¹´12æœˆ 