<!DOCTYPE html>
<html>
<head>
    <title>HTTP-FLV测试</title>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/flv.js@1.5.0/dist/flv.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #videoContainer { max-width: 800px; margin: 0 auto; }
        video { width: 100%; background-color: #000; }
        .controls { margin-top: 10px; }
        button { padding: 5px 10px; margin-right: 5px; }
    </style>
</head>
<body>
    <div id="videoContainer">
        <h2>HTTP-FLV流媒体测试</h2>
        <video id="videoElement" controls></video>
        <div class="controls">
            <input type="text" id="streamName" placeholder="输入流名称，例如：test" value="test">
            <button onclick="startPlay()">开始播放</button>
            <button onclick="stopPlay()">停止播放</button>
        </div>
        <div id="status"></div>
    </div>

    <script>
        let flvPlayer = null;
        
        function startPlay() {
            if (flvPlayer !== null) {
                stopPlay();
            }
            
            const streamName = document.getElementById('streamName').value;
            if (!streamName) {
                updateStatus('请输入流名称');
                return;
            }
            
            const flvUrl = `http://localhost:8080/live/${streamName}.flv`;
            updateStatus(`正在连接: ${flvUrl}`);
            
            if (flvjs.isSupported()) {
                const videoElement = document.getElementById('videoElement');
                flvPlayer = flvjs.createPlayer({
                    type: 'flv',
                    url: flvUrl,
                    isLive: true,
                    hasAudio: true,
                    hasVideo: true
                });
                
                flvPlayer.attachMediaElement(videoElement);
                flvPlayer.load();
                flvPlayer.play();
                
                flvPlayer.on(flvjs.Events.ERROR, (errorType, errorDetail) => {
                    updateStatus(`播放错误: ${errorType} - ${errorDetail}`);
                });
                
                flvPlayer.on(flvjs.Events.STATISTICS_INFO, (stats) => {
                    updateStatus(`正在播放 - 速度: ${Math.round(stats.speed / 1024)} KB/s`);
                });
            } else {
                updateStatus('您的浏览器不支持FLV.js');
            }
        }
        
        function stopPlay() {
            if (flvPlayer !== null) {
                flvPlayer.pause();
                flvPlayer.unload();
                flvPlayer.detachMediaElement();
                flvPlayer.destroy();
                flvPlayer = null;
                updateStatus('已停止播放');
            }
        }
        
        function updateStatus(message) {
            document.getElementById('status').innerText = message;
        }
    </script>
</body>
</html> 